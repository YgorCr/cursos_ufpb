%h2 Gráficos

#chart-average.chart
%hr
#chart-bubble.chart
%hr
#chart-situation.chart

%h2 Dados

%p Os seguintes dados foram extraídos e calculados do seu histórico para o cálculo das estatísticas.

.row
  .col-md-6.col-md-offset-3
    %table.table.table-striped.table-hover
      %tr
        %th.text-center Semestre
        %th.text-center CRA efetivo
        %th.text-center CRA sem reprovações

      - @semester_average.each do |semester_average|
        %tr.text-center
          %td= semester_average[0][:f]
          %td= semester_average[1]
          %td= semester_average[2]

.row
  .col-md-6.col-md-offset-3
    %table.table.table-striped.table-hover
      %tr
        %th.text-center Situação disciplina
        %th.text-center Número absoluto
        %th.text-center Porcentagem

      - @courses_groupped_by_situation.each do |situation, count|
        %tr.text-center
          %td= situation
          %td= count
          %td= ((count / @total_courses.to_f * 100).round(2)).to_s + '%'

.row
  .col-md-8.col-md-offset-2
    %table.table.table-striped.table-hover
      %tr
        %th.text-center Semestre
        %th.text-center Disciplina
        %th.text-center Nota
        %th.text-center Situação

      - @results.results.sort_by(&:semester).each do |cr|
        %tr.text-center
          %td= cr.semester
          %td= cr.name
          %td= cr.grade
          %td= cr.situation

%p Caso você perceba algum erro, por favor entre em contato com cursos-ufpb [@] fernandobrito [ponto] com.

= content_for :css_code do
  :css
    .chart {
      width: 100%;
      height: 500px;
    }

= content_for :js_includes do
  = javascript_include_tag 'https://www.gstatic.com/charts/loader.js'
  = include_gon

= content_for :js_code do
  :javascript
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawLineChart);
    google.charts.setOnLoadCallback(drawPieChart);
    google.charts.setOnLoadCallback(drawBubbleChart);

    function drawBubbleChart() {
      var data = google.visualization.arrayToDataTable(gon.bubble);

      var options = {
        title: 'Gráfico de bolha das disciplinas cursadas',
        titleTextStyle: { fontSize: 19 },
        hAxis: {
          title: 'Semestre',
          ticks: $.map(gon.bubble, function(val) { return val[1] }),
          viewWindow: { min: -1, max: gon.bubble_semesters_max + 1},
          baselineColor: '#ccc'
        },
        vAxis: {
          title: 'Nota',
          viewWindow: { min: gon.bubble_min_grade * 0.9, max: gon.bubble_max_grade * 1.05 }
        },
        sizeAxis: { minSize: 10,  maxSize: 20} ,
        bubble: {textStyle: {fontSize: 9}},
        chartArea: { width: '87%', height: '70%' },
        colorAxis: {colors: ['red', 'orange', 'green']}
      };

      var chart = new google.visualization.BubbleChart(document.getElementById('chart-bubble'));
      chart.draw(data, options);
    }

    function drawPieChart() {
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Situação da disciplina');
      data.addColumn('number', 'Quantidade');
      data.addRows(gon.courses_groupped_by_situation);

      // Set chart options
      var options = {
        title: 'Disciplinas agrupadas por situação',
        titleTextStyle: { fontSize: 19 }
      };

      // Instantiate and draw our chart, passing in some options.
      var chart = new google.visualization.PieChart(document.getElementById('chart-situation'));
      chart.draw(data, options);
    }

    function drawLineChart() {
      var data = new google.visualization.DataTable();
      data.addColumn('number', 'Semestre');
      data.addColumn('number', 'CRA efetivo');
      data.addColumn('number', 'CRA sem reprovações');
      data.addRows(gon.semesters_average);

      // Set chart options
      var options = {
        title: 'Evolução do CRA ao longo dos semestres',
        titleTextStyle: { fontSize: 19 },
        curveType: 'function',
        legend: { position: 'bottom' },
        pointSize: 8,
        chartArea: { width: '87%', height: '70%', backgroundColor: { stroke: 'white' } },
        vAxis: {
          title: 'CRA',
          format: '0.00'
        },
        hAxis: {
          title: 'Semestre',
          ticks: $.map(gon.semesters_average, function(val) { return val[0] }),
          baselineColor: '#ccc'
        },
        series: {
            1: { lineDashStyle: [3, 9] },
        }
      };

      // Instantiate and draw our chart, passing in some options.
      var chart = new google.visualization.LineChart(document.getElementById('chart-average'));
      chart.draw(data, options);

      function resizeChart () {
        chart.draw(data, options);
      }

      if (document.addEventListener) {
        window.addEventListener('resize', resizeChart);
      }
      else if (document.attachEvent) {
        window.attachEvent('onresize', resizeChart);
      }
      else {
        window.resize = resizeChart;
      }
    }